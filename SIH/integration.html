<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindCare Chatbot</title>
    <!-- Tailwind CSS for a utility-first approach -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0F0F;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        
        /* --- Floating Chat Icon (FAB) Styles --- 
        #chatbot-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            background-image: linear-gradient(to right, #0A0F0F, #1E2B2B);
            animation: pulse 2s infinite;
            z-index: 100;
        }*/

        #chatbot-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: none;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* --- Chat Panel & Overlay Styles --- */
        #chatbot-panel {
            position: fixed;
            top: 20px; 
            bottom: 20px;
            right: -420px; 
            width: 400px; 
            background-color: #1E2B2B;
            box-shadow: -10px 0 20px rgba(0, 0, 0, 0.5);
            transition: right 0.3s ease-out;
            z-index: 50;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: 0; 
        }

        #chatbot-panel.open {
            right: 20px; /* Slides into view with 20px inset */
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
            display: none;
            transition: opacity 0.3s ease-in-out;
            opacity: 1;
        }
            
        #overlay.active {
            display: block;
            opacity: 1;
        }
        
        /* --- Mobile Responsiveness --- */
        @media (max-width: 768px) {
            #chatbot-panel {
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                transform: none;
                border-radius: 0;
            }
        }

        /* --- Message Bubble Styles --- */
        .message-bubble {
            padding: 0.75rem 1rem;
            border-radius: 10px;
            max-width: 80%;
            font-size: 0.9rem;
            line-height: 1.4;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .message-bubble.user {
            background-color: #3E5959;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        .message-bubble.bot {
            background-color: #2A3C3C;
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .bot-message-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            align-self: flex-start;
        }
        .bot-avatar {
            width: 32px;
            height: 32px;
            border-radius: 9999px;
            background-color: #4c3e59;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FFFFFF;
            flex-shrink: 0;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: #2A3C3C;
            border-radius: 10px;
            max-width: min-content;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #AAAAAA;
            border-radius: 50%;
            animation: bounce 0.6s infinite alternate;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-4px); }
        }

        #intro-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
            padding: 1rem;
            background-color: #1E2B2B;
            color: #FFFFFF;
        }
        
        #intro-screen h3 {
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        #hello-button {
            background-color: #3E5959;
            color: #FFFFFF;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        #hello-button:hover {
            background-color: #557777;
        }
    </style>
</head>
<body class="bg-[#0A0F0F]">

    <!-- Floating Action Button Icon -->
    <div id="chatbot-icon" aria-label="Open chat" role="button" tabindex="0">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V3a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </div>

    <!-- Semi-transparent overlay -->
    <div id="overlay"></div>

    <!-- Chatbot Panel -->
    <div id="chatbot-panel">
        <!-- Header -->
        <header class="flex items-center justify-between p-4 h-20" style="background: linear-gradient(to right, #0A0F0F, #1E2B2B);">
            <div class="flex items-center space-x-2">
                <!-- MindCare Logo -->
                <div class="flex items-center justify-center w-12 h-12 rounded-full bg-white shadow-md">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-3.86 0-7-3.14-7-7 0-.71.1-1.4.29-2.06.66 1.48 1.96 2.54 3.51 2.87 1.8.38 3.65-.21 5.07-1.43 1.09-.94 1.83-2.14 2.15-3.48.3-.12.61-.21.93-.25 3.19.86 5.37 3.86 5.05 7.02-.19 1.93-1.12 3.69-2.5 5.06-1.55 1.58-3.71 2.45-6.04 2.45z" fill="#3E5959"/>
                        <path d="M12 16.5c2.4 0 4.5-1.5 5.2-3.6M12 7.5c-2.4 0-4.5 1.5-5.2 3.6" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round"/>
                        <path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" fill="#FFFFFF"/>
                        <path d="M12 12c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1z" fill="white"/>
                        <path d="M12 12c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1z" fill="white"/>
                    </svg>
                </div>
                <div class="flex flex-col">
                    <h2 class="text-xl font-bold text-white font-['Poppins']">MindCare</h2>
                </div>
            </div>
            
        </header>
        
        <!-- Welcome Screen -->
        <div id="intro-screen">
            <h3 class="text-xl font-semibold mb-8 text-white">Hi! I'm a virtual assistant. How can I help you today?</h3>
            <button id="hello-button" class="px-6 py-2 bg-[#3E5959] text-white rounded-full font-semibold hover:bg-[#557777] transition-colors">Hello</button>
        </div>

        <!-- Message History -->
        <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4 hidden">
            <!-- Messages will appear here -->
        </div>

        <!-- Input Area -->
        <footer id="input-area" class="p-4 border-t border-gray-700 bg-[#1A1F1F] flex items-center space-x-2 shadow-inner hidden">
            <input type="text" id="message-input" class="flex-1 p-3 rounded-full border border-gray-600 bg-transparent text-white focus:outline-none focus:ring-2 focus:ring-teal-500 placeholder-gray-400" placeholder="Type something...">
            <button id="send-button" class="w-10 h-10 flex items-center justify-center rounded-full text-white bg-[#3E5959] hover:bg-[#557777] transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="22" y1="2" x2="11" y2="13"></line>
        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
    </svg>
</button>

        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatbotIcon = document.getElementById('chatbot-icon');
            const chatbotPanel = document.getElementById('chatbot-panel');
            const closeButton = document.getElementById('close-button');
            const overlay = document.getElementById('overlay');
            const introScreen = document.getElementById('intro-screen');
            const helloButton = document.getElementById('hello-button');
            const chatHistory = document.getElementById('chat-history');
            const inputArea = document.getElementById('input-area');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');

            // API configuration
            const apiKey = "AIzaSyAtqUmyLNEuY9DhtKnXLyDONawaRl4Jum8"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const welcomeMessage = "Hi, I'm MindCare, your confidential mental health buddy. I'm here to listen, support, and guide you with stress, anxiety, and wellbeing. Remember, everything we discuss is private and confidential. How can I help you today?";

            function appendMessage(sender, text) {
                const messageContainer = document.createElement('div');
                const isUser = sender === 'user';
                
                messageContainer.classList.add('message-bubble', 'rounded-lg', 'shadow-md', 'message-fade-in', 'max-w-xs');

                if (isUser) {
                    messageContainer.classList.add('user', 'bg-[#3E5959]', 'text-white', 'self-end');
                    messageContainer.textContent = text;
                    chatHistory.appendChild(messageContainer);
                } else {
                    messageContainer.classList.add('bot', 'bg-[#2A3C3C]', 'text-white', 'self-start');
                    const wrapper = document.createElement('div');
                    wrapper.classList.add('bot-message-wrapper');
                    const avatar = document.createElement('div');
                    avatar.classList.add('bot-avatar');
                    avatar.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="11" width="18" height="10" rx="2" ry="2"></rect>
                            <circle cx="12" cy="5" r="3"></circle>
                            <path d="M7 11v-1a5 5 0 0 1 10 0v1"></path>
                        </svg>`;
                     messageContainer.innerHTML = text;
                    wrapper.appendChild(avatar);
                    wrapper.appendChild(messageContainer);
                    chatHistory.appendChild(wrapper);
                }
                
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
            function getSpecificHelpResponse(message) {
    const lowerCaseMsg = message.toLowerCase();

    // Emergency / suicidal intent (India-only response)
    if (
        lowerCaseMsg.includes('emergency') || 
        lowerCaseMsg.includes('dying') || 
        lowerCaseMsg.includes('suicidal') || 
        lowerCaseMsg.includes('kill myself') || 
        lowerCaseMsg.includes('killing myself') || 
        lowerCaseMsg.includes('end my life') ||
        lowerCaseMsg.includes('want to die') ||
        lowerCaseMsg.includes('hopeless')
    ) {
        return `
I hear you, and I want you to know you are not alone.  
Please reach out for help immediately. Here are trusted mental health helplines in India:<br>

1. <a href="tel:18005990019" class="text-blue-400 underline">KIRAN (24/7 National Helpline): 1800-599-0019</a> <br> 
2. <a href="tel:+912227546669" class="text-blue-400 underline">AASRA (Suicide Prevention): +91-22-27546669 / 27546667</a>  <br>
3. <a href="tel:18602662345" class="text-blue-400 underline">Vandrevala Foundation Helpline: 1860-2662-345 / 9999-666-555</a>  <br>

If you are in immediate danger, please call these numbers right now.  

You can also book a confidential session with a counsellor immediately through our website’s Anonymous Counselling section. A professional can support you right away.
        `;
    }

    // Other keywords → personalized help
    if (lowerCaseMsg.includes('book') || lowerCaseMsg.includes('reading')) {
        return "Reading can be a great way to relax. You might like 'The Midnight Library' by Matt Haig or 'Reasons to Stay Alive' by Matt Haig. They are often comforting.";
    }
    if (lowerCaseMsg.includes('audio') || lowerCaseMsg.includes('meditation') || lowerCaseMsg.includes('podcast')) {
        return "Listening to calming audios can really help. Try guided meditations or stress-relief podcasts on YouTube or Spotify.";
    }
    if (lowerCaseMsg.includes('breathing') || lowerCaseMsg.includes('exercise') || lowerCaseMsg.includes('breathe')) {
        return "Try the 4-7-8 breathing technique: Inhale for 4 seconds, hold for 7 seconds, and exhale for 8 seconds. It's scientifically proven to calm stress.";
    }
    if (lowerCaseMsg.includes('coping mechanism') || lowerCaseMsg.includes('stress')) {
        return "Healthy coping can be journaling, walking, listening to music, or talking with friends. Which one works best for you?";
    }
    if (
        lowerCaseMsg.includes('psychologist') || 
        lowerCaseMsg.includes('counselor') || 
        lowerCaseMsg.includes('therapist') || 
        lowerCaseMsg.includes('professional help') || 
        lowerCaseMsg.includes('helpline')
    ) {
        return "It takes courage to reach out. You can directly call KIRAN 1800-599-0019, or use our website's Anonymous Counselling booking feature to talk to a professional privately.";
    }

    return null; // fallback → Gemini API
}

            async function sendMessage() {
                const userMessage = messageInput.value.trim();
                if (userMessage === '') return;

                appendMessage('user', userMessage);
                messageInput.value = '';

                const typingIndicator = document.createElement('div');
                typingIndicator.classList.add('typing-indicator', 'self-start');
                typingIndicator.innerHTML = `<span></span><span></span><span></span>`;
                chatHistory.appendChild(typingIndicator);
                chatHistory.scrollTop = chatHistory.scrollHeight;

                const specificResponse = getSpecificHelpResponse(userMessage);

                if (specificResponse) {
                    chatHistory.removeChild(typingIndicator);
                    appendMessage('bot', specificResponse);
                } else {
                    try {
                        const payload = {
                            contents: [{ parts: [{ text: userMessage }] }],
                            systemInstruction: {
                                parts: [{ text: `
                                    You are a supportive and empathetic digital companion named MindCare. Your goal is to provide a safe, non-judgmental space for students to talk about their feelings. Use a warm, gentle, and conversational tone. Acknowledge the user's emotions and respond with care. Keep your responses short, simple, and direct. Do not give medical advice, diagnoses, or treatment plans. Refer the user to professional resources when appropriate.
                                ` }]
                            },
                        };

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        
                        const result = await response.json();
                        const botResponse = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                        
                        chatHistory.removeChild(typingIndicator);
                        
                        if (botResponse) {
                            appendMessage('bot', botResponse);
                        } else {
                            appendMessage('bot', "I'm sorry, I couldn't generate a response. Please try again or check your connection.");
                            console.error('API response was empty or malformed.');
                        }
                    } catch (error) {
                        console.error('Error fetching API response:', error);
                        chatHistory.removeChild(typingIndicator);
                        appendMessage('bot', 'An error occurred. Please check your network connection and try again.');
                    }
                }
            }

            chatbotIcon.addEventListener('click', () => {
                chatbotPanel.classList.add('open');
                overlay.classList.add('active');
            });
            
            helloButton.addEventListener('click', () => {
                // Remove intro screen entirely so it doesn't occupy any space
                if (introScreen && introScreen.parentNode) {
                    introScreen.parentNode.removeChild(introScreen);
                }
                chatHistory.classList.remove('hidden');
                inputArea.classList.remove('hidden');
                appendMessage('bot', welcomeMessage);
                // Focus the input for immediate typing
                messageInput.focus();
            });

            closeButton.addEventListener('click', () => {
                chatbotPanel.classList.remove('open');
                overlay.classList.remove('active');
            });

            overlay.addEventListener('click', () => {
                chatbotPanel.classList.remove('open');
                overlay.classList.remove('active');
            });


                document.addEventListener("DOMContentLoaded", () => {

            sendButton.addEventListener("click", sendMessage);

            messageInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    sendMessage();
                }
            });
        });


            messageInput.addEventListener('input', () => {
                sendButton.disabled = messageInput.value.trim() === '';
            });
            sendButton.disabled = true;
        });
    </script>
</body>
</html>
